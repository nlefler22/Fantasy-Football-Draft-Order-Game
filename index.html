<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fantasy Football Draft Race</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #1e3d1a;
      color: white;
      padding: 20px;
    }
    h2, .instructions {
      text-align: center;
    }
    .note {
      background: #eef9ff;
      color: #000;
      padding: 10px;
      border-left: 5px solid #0077cc;
      margin: 10px 0 20px 0;
    }
    #raceField {
      position: relative;
      width: 800px;
      height: 500px;
      background: repeating-linear-gradient(to right, #2e8b57, #2e8b57 50px, #228b22 50px, #228b22 100px);
      border: 4px solid white;
      margin: 20px auto 0 auto;
      overflow: hidden;
    }
    .runner {
      position: absolute;
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 60px;
    }
    .runner img {
      width: 40px;
      height: 40px;
    }
    table, th, td {
      border: 1px solid #444;
      border-collapse: collapse;
      padding: 5px 10px;
      background: white;
      color: black;
    }
    #nextRoundContainer {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: none;
      z-index: 10;
    }
    #nextRoundBtn {
      padding: 10px 25px;
      font-size: 20px;
      background-color: #0077cc;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    #startOverBtn {
      margin-left: 20px;
      padding: 8px 18px;
      font-size: 14px;
      background-color: #cc3300;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    #totalOdds {
      font-weight: bold;
      margin-top: 10px;
    }
    #setup {
      text-align: center;
    }
    #results {
      margin-top: 20px;
      display: none;
      text-align: center;
    }
    #winnerTable {
      margin: 20px auto;
    }
  </style>
</head>
<body>

<h2>Fantasy Football Draft Race</h2>
<div class="instructions">
  <p><strong>Instructions:</strong> 1/ Select the number of players, 2/ Input your custom odds, 3/ Start the race. After each race, click "Next Round" to continue determining 2nd, 3rd, etc... At the end of the last round, the complete draft order will be determined.</p>
  <p class="note"><strong>Methodology:</strong> The winner of each round is determined by weighted random selection based purely on the odds provided. After each round, the previous winner is removed and the selection is made again with the remaining players, based on the updated odds.</p>
</div>

<div id="setup">
  <label>Number of Players:
    <input type="number" id="playerCount" min="2" max="12" value="6">
  </label>
  <button onclick="generatePlayerInputs()">Set Players</button>
  <button id="startOverBtn" onclick="resetRace()">Start Over</button>
  <form id="playerForm"></form>
  <div id="totalOdds">Total Odds: 0%</div>
  <button onclick="startNextRace()">Start Race</button>
</div>

<div id="raceField">
  <div id="nextRoundContainer">
    <button id="nextRoundBtn" onclick="startNextRace()">Next Round</button>
  </div>
</div>

<div id="results">
  <h3>Draft Order</h3>
  <table id="winnerTable">
    <tr><th>Draft Pick</th><th>Player</th></tr>
  </table>
</div>

<audio id="whistle" src="https://www.soundjay.com/button/sounds/beep-07.mp3" preload="auto"></audio>
<audio id="cheer" src="https://www.soundjay.com/human/sounds/applause-8.mp3" preload="auto"></audio>

<script>
let originalPlayers = [];
let remainingPlayers = [];
let finalOrder = [];
const raceField = document.getElementById("raceField");

function generatePlayerInputs() {
  const count = parseInt(document.getElementById('playerCount').value);
  const form = document.getElementById('playerForm');
  form.innerHTML = '';
  for (let i = 0; i < count; i++) {
    form.innerHTML += `
      <div>
        <label>Player ${i + 1} Name: <input type="text" id="name${i}" value="Player ${i + 1}"></label>
        <label>Odds (%): <input type="number" id="odds${i}" step="0.1" value="${(100 / count).toFixed(1)}" oninput="updateTotalOdds()"></label>
      </div>
    `;
  }
  updateTotalOdds();
}

function updateTotalOdds() {
  let total = 0;
  const count = parseInt(document.getElementById('playerCount').value);
  for (let i = 0; i < count; i++) {
    const val = parseFloat(document.getElementById(`odds${i}`).value);
    total += isNaN(val) ? 0 : val;
  }
  const totalOddsElem = document.getElementById('totalOdds');
  totalOddsElem.innerText = `Total Odds: ${total.toFixed(1)}%`;
  totalOddsElem.style.color = (Math.abs(total - 100) < 0.1) ? 'green' : 'red';
}

function resetRace() {
  remainingPlayers = [...originalPlayers];
  finalOrder = [];
  updateResultTable();
  document.getElementById('results').style.display = 'none';
  document.getElementById('nextRoundContainer').style.display = 'none';
}

function weightedDraw(players) {
  const total = players.reduce((sum, p) => sum + p.odds, 0);
  const rand = Math.random() * total;
  let running = 0;
  for (let p of players) {
    running += p.odds;
    if (rand < running) return p;
  }
  return players[players.length - 1];
}

function startNextRace() {
  document.getElementById('nextRoundContainer').style.display = 'none';

  if (originalPlayers.length === 0) {
    const count = parseInt(document.getElementById('playerCount').value);
    originalPlayers = [];
    for (let i = 0; i < count; i++) {
      const name = document.getElementById(`name${i}`).value;
      const odds = parseFloat(document.getElementById(`odds${i}`).value);
      originalPlayers.push({ name, odds });
    }
    remainingPlayers = [...originalPlayers];
    finalOrder = [];
    updateResultTable();
  }

  if (remainingPlayers.length === 2) {
    const winner = weightedDraw(remainingPlayers);
    const loser = remainingPlayers.find(p => p.name !== winner.name);
    animateRace(winner.name, () => {
      finalOrder.push(winner.name);
      finalOrder.push(loser.name);
      updateResultTable();
      document.getElementById('cheer').play();
      document.getElementById('results').style.display = 'block';
      remainingPlayers = [];
    });
    return;
  }

  const winner = weightedDraw(remainingPlayers);
  animateRace(winner.name, () => {
    finalOrder.push(winner.name);
    remainingPlayers = remainingPlayers.filter(p => p.name !== winner.name);
    updateResultTable();
    document.getElementById('cheer').play();
    document.getElementById('nextRoundContainer').style.display = 'block';
  });
}

function updateResultTable() {
  const table = document.getElementById('winnerTable');
  table.innerHTML = '<tr><th>Draft Pick</th><th>Player</th></tr>';
  finalOrder.forEach((name, i) => {
    const row = table.insertRow();
    row.insertCell().innerText = i + 1;
    row.insertCell().innerText = name;
  });
  if (finalOrder.length > 0) {
    document.getElementById('results').style.display = 'block';
  }
}

function animateRace(winnerName, callback) {
  document.getElementById('whistle').play();
  raceField.innerHTML = '<div id="nextRoundContainer"><button id="nextRoundBtn" onclick="startNextRace()">Next Round</button></div>';
  const finishLine = 740;

  const runners = remainingPlayers.map((player, index) => {
    const runnerDiv = document.createElement('div');
    runnerDiv.className = 'runner';
    runnerDiv.style.top = (index * 60 + 10) + 'px';

    const img = document.createElement('img');
    img.src = 'https://i.postimg.cc/mgFxbxtn/Pixelated-Football-Player-in-Motion.png';
    img.alt = player.name;

    const label = document.createElement('div');
    label.innerText = player.name;
    label.style.color = 'white';
    label.style.fontSize = '12px';

    runnerDiv.appendChild(img);
    runnerDiv.appendChild(label);
    raceField.appendChild(runnerDiv);

    return {
      name: player.name,
      div: runnerDiv,
      x: 0,
      zone1: (player.name === winnerName) ? 2 : (Math.random() > 0.5 ? 2.2 : 2.4),
      zone2: (player.name === winnerName) ? 3 : (Math.random() > 0.5 ? 1.6 : 1.2)
    };
  });

  const winnerRunner = runners.find(r => r.name === winnerName);

  const interval = setInterval(() => {
    runners.forEach(runner => {
      const percent = runner.x / finishLine;
      const speed = (percent < 0.7) ? runner.zone1 : runner.zone2;
      runner.x += speed + Math.random();
      if (runner.name !== winnerName && runner.x >= finishLine * 0.99) {
        runner.x = finishLine * 0.99;
      }
      runner.div.style.left = Math.min(runner.x, finishLine) + 'px';
    });

    if (winnerRunner.x >= finishLine) {
      clearInterval(interval);
      winnerRunner.div.style.left = finishLine + 'px';
      callback();
    }
  }, 30);
}

window.onload = generatePlayerInputs;
</script>

</body>
</html>
