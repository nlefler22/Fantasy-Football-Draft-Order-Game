<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fantasy Football Draft Race</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #1e3d1a;
      color: white;
      padding: 20px;
    }
    h2 {
      text-align: center;
    }
    .note, .instructions {
      background: #eef9ff;
      color: #000;
      padding: 10px;
      border-left: 5px solid #0077cc;
      margin-bottom: 10px;
    }
    #raceField {
      position: relative;
      width: 800px;
      height: 500px;
      background: repeating-linear-gradient(to right, #2e8b57, #2e8b57 50px, #228b22 50px, #228b22 100px);
      border: 4px solid white;
      margin: 20px auto;
      overflow: hidden;
    }
    .runner {
      position: absolute;
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 60px;
    }
    .runner img {
      width: 40px;
      height: 40px;
    }
    table, th, td {
      border: 1px solid #444;
      border-collapse: collapse;
      padding: 5px 10px;
      background: white;
      color: black;
    }
    #nextRoundContainer {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: none;
      z-index: 10;
    }
    #nextRoundBtn, #startOverBtn {
      padding: 10px 25px;
      font-size: 20px;
      background-color: #0077cc;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin: 10px;
    }
    #setup {
      text-align: center;
    }
    #winnersTable {
      margin: 0 auto;
      margin-top: 20px;
      display: none;
    }
    #totalOdds {
      font-weight: bold;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<h2>Fantasy Football Draft Race</h2>
<div class="instructions">
  <strong>Instructions:</strong> 1/ Select the number of players, 2/ Input your custom odds, 3/ Start the race. After each race, click "Next Round" to continue determining 2nd, 3rd, etc... At the end of the last round, the complete draft order will be determined.
</div>
<div class="note">
  <strong>Methodology:</strong> The winner of each round is determined by weighted random selection based purely on the odds provided. After each round, the previous winner is removed and the selection is made again with the remaining players, based on the updated odds.
</div>

<div id="setup">
  <label>Number of Players:
    <input type="number" id="playerCount" min="2" max="12" value="6">
  </label>
  <button onclick="generatePlayerInputs()">Set Players</button>
  <form id="playerForm"></form>
  <div id="totalOdds">Total Odds: 0%</div>
  <button onclick="startNextRace()">Start Race</button>
  <button id="startOverBtn" onclick="startOver()">Start Over</button>
</div>

<div id="raceField">
  <div id="nextRoundContainer">
    <button id="nextRoundBtn" onclick="startNextRace()">Next Round</button>
  </div>
</div>

<table id="winnersTable">
  <thead><tr><th>Draft Pick</th><th>Player</th></tr></thead>
  <tbody id="winnersBody"></tbody>
</table>

<script>
let originalPlayers = [];
let remainingPlayers = [];
let finalOrder = [];

function generatePlayerInputs() {
  const count = parseInt(document.getElementById('playerCount').value);
  const form = document.getElementById('playerForm');
  form.innerHTML = '';
  for (let i = 0; i < count; i++) {
    form.innerHTML += `
      <div>
        <label>Player ${i + 1} Name: <input type="text" id="name${i}" value="Player ${i + 1}"></label>
        <label>Odds (%): <input type="number" id="odds${i}" step="0.1" value="${(100 / count).toFixed(1)}" oninput="updateTotalOdds()"></label>
      </div>
    `;
  }
  updateTotalOdds();
}

function updateTotalOdds() {
  let total = 0;
  const count = parseInt(document.getElementById('playerCount').value);
  for (let i = 0; i < count; i++) {
    const val = parseFloat(document.getElementById(`odds${i}`).value);
    total += isNaN(val) ? 0 : val;
  }
  const totalOddsElem = document.getElementById('totalOdds');
  totalOddsElem.innerText = `Total Odds: ${total.toFixed(1)}%`;
  totalOddsElem.style.color = (Math.abs(total - 100) < 0.1) ? 'green' : 'red';
}

function weightedDraw(players) {
  const total = players.reduce((sum, p) => sum + p.odds, 0);
  const rand = Math.random() * total;
  let running = 0;
  for (let p of players) {
    running += p.odds;
    if (rand < running) return p;
  }
  return players[players.length - 1];
}

function startOver() {
  remainingPlayers = [...originalPlayers];
  finalOrder = [];
  document.getElementById("winnersTable").style.display = "none";
  document.getElementById("winnersBody").innerHTML = "";
  document.getElementById("nextRoundContainer").style.display = "none";
}

function startNextRace() {
  document.getElementById("nextRoundContainer").style.display = "none";

  if (originalPlayers.length === 0) {
    const count = parseInt(document.getElementById('playerCount').value);
    for (let i = 0; i < count; i++) {
      const name = document.getElementById(`name${i}`).value;
      const odds = parseFloat(document.getElementById(`odds${i}`).value);
      originalPlayers.push({ name, odds });
    }
    remainingPlayers = [...originalPlayers];
  }

  const winner = weightedDraw(remainingPlayers);
  animateRace(winner.name, () => {
    finalOrder.push(winner.name);
    remainingPlayers = remainingPlayers.filter(p => p.name !== winner.name);
    updateWinnersTable();
    if (remainingPlayers.length > 0) {
      document.getElementById("nextRoundContainer").style.display = "block";
    }
  });
}

function updateWinnersTable() {
  const table = document.getElementById("winnersTable");
  const body = document.getElementById("winnersBody");
  body.innerHTML = "";
  finalOrder.forEach((name, index) => {
    const row = document.createElement("tr");
    row.innerHTML = `<td>${index + 1}</td><td>${name}</td>`;
    body.appendChild(row);
  });
  table.style.display = "table";
}

function animateRace(winnerName, callback) {
  const raceField = document.getElementById("raceField");
  raceField.innerHTML = '<div id="nextRoundContainer"><button id="nextRoundBtn" onclick="startNextRace()">Next Round</button></div>';

  const finishLine = 800 - 60;
  const runners = remainingPlayers.map((p, i) => {
    const div = document.createElement("div");
    div.className = "runner";
    div.style.top = `${i * 60 + 10}px`;
    div.innerHTML = `<img src="https://i.postimg.cc/mgFxbxtn/Pixelated-Football-Player-in-Motion.png"><div>${p.name}</div>`;
    raceField.appendChild(div);
    return { name: p.name, div, x: 0 };
  });

  const winner = runners.find(r => r.name === winnerName);
  const others = runners.filter(r => r.name !== winnerName);
  const groupA = others.slice(0, Math.ceil(others.length / 2));
  const groupB = others.slice(Math.ceil(others.length / 2));

  const interval = setInterval(() => {
    runners.forEach(r => {
      const percent = r.x / finishLine;
      if (r.name === winner.name) {
        r.x += percent < 0.7 ? 2.5 + Math.random() : 4 + Math.random();
      } else if (groupA.includes(r)) {
        r.x += percent < 0.7 ? 2 + Math.random() : 1 + Math.random();
      } else {
        r.x += percent < 0.7 ? 2.2 + Math.random() : 1.5 + Math.random();
      }
      r.div.style.left = Math.min(r.x, finishLine) + 'px';
    });

    if (winner.x >= finishLine) {
      clearInterval(interval);
      winner.div.style.left = finishLine + 'px';
      callback();
    }
  }, 30);
}

window.onload = generatePlayerInputs;
</script>

</body>
</html>
