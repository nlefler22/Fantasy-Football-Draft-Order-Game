<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fantasy Football Draft Race</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #1e3d1a;
      color: white;
      margin: 0;
      padding: 0;
    }
    h2 {
      text-align: center;
      margin-top: 20px;
    }
    .container {
      max-width: 800px;
      margin: auto;
      padding: 20px;
    }
    .collapsible {
      background-color: #2a5934;
      color: white;
      cursor: pointer;
      padding: 14px;
      border: none;
      text-align: left;
      outline: none;
      font-size: 18px;
      width: 100%;
      margin-bottom: 5px;
    }
    .content {
      padding: 10px;
      display: none;
      background-color: #f9f9f9;
      color: black;
      border-left: 5px solid #0077cc;
      margin-bottom: 15px;
    }
    #setup {
      background-color: #fff;
      color: #000;
      padding: 20px;
      border-radius: 8px;
    }
    #setup input[type="number"], #setup input[type="text"] {
      padding: 8px;
      font-size: 16px;
      margin: 5px;
    }
    .player-row {
      display: flex;
      gap: 10px;
      margin-bottom: 8px;
    }
    .button-group {
      display: flex;
      justify-content: space-around;
      margin-top: 10px;
    }
    .action-button {
      background-color: #f4b400;
      border: none;
      padding: 15px 25px;
      font-size: 18px;
      font-weight: bold;
      border-radius: 8px;
      cursor: pointer;
    }
    #raceField {
      position: relative;
      background: url("https://i.postimg.cc/HsjfycJx/Field-Only-High-Res.png") center/cover no-repeat;
      height: 400px;
      margin-top: 20px;
      overflow: hidden;
      border: 4px solid white;
    }
    #logoOverlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 1;
      pointer-events: none;
      width: 120px;
    }
    .runner {
      position: absolute;
      display: flex;
      flex-direction: column;
      align-items: center;
      z-index: 2;
    }
    .runner img {
      width: 40px;
    }
    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
      background: white;
      color: black;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
    }
    @media screen and (max-width: 600px) {
      .player-row {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Fantasy Football Draft Pick</h2>

    <button class="collapsible">Instructions</button>
    <div class="content">
      <p>Select the number of players, assign each a percentage chance, and start the race to determine draft order!</p>
    </div>

    <button class="collapsible">Methodology</button>
    <div class="content">
      <p>The winner of each round is determined by weighted random selection based purely on the odds provided. After each round, the winner is removed and the process continues.</p>
    </div>

    <div id="setup">
      <label>Number of players: <input type="number" id="playerCount" min="2" max="12" value="3" onchange="generatePlayerInputs()"></label>
      <div id="playerForm"></div>
      <div id="totalOdds">Total Odds: 100%</div>
      <div class="button-group">
        <button class="action-button" onclick="startNextRace()">START RACE</button>
        <button class="action-button" onclick="toggleMusic()">START / STOP MUSIC</button>
      </div>
    </div>

    <div id="raceField">
      <img id="logoOverlay" src="https://i.postimg.cc/CnSCd3QJ/ffdraftracelogo.png" alt="Logo">
    </div>

    <div id="results">
      <table>
        <thead>
          <tr><th>Draft Pick</th><th>Player</th></tr>
        </thead>
        <tbody id="resultTable"></tbody>
      </table>
    </div>
  </div>

  <audio id="backgroundMusic" loop>
    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-9.mp3" type="audio/mpeg">
  </audio>
  <audio id="whistle" src="https://www.soundjay.com/button/sounds/beep-07.mp3"></audio>
  <audio id="cheer" src="https://www.soundjay.com/human/sounds/applause-8.mp3"></audio>

  <script>
    let players = [];
    let finalOrder = [];

    function generatePlayerInputs() {
      const count = parseInt(document.getElementById('playerCount').value);
      const form = document.getElementById('playerForm');
      form.innerHTML = '';
      players = [];
      for (let i = 0; i < count; i++) {
        form.innerHTML += `
          <div class="player-row">
            <input type="text" id="name${i}" value="Player ${i+1}" placeholder="Name">
            <input type="number" id="odds${i}" value="${(100/count).toFixed(1)}" step="0.1" placeholder="Odds %" onchange="updateTotalOdds()">
          </div>`;
      }
      updateTotalOdds();
    }

    function updateTotalOdds() {
      const count = parseInt(document.getElementById('playerCount').value);
      let total = 0;
      for (let i = 0; i < count; i++) {
        const val = parseFloat(document.getElementById(`odds${i}`).value);
        total += isNaN(val) ? 0 : val;
      }
      const totalOddsElem = document.getElementById('totalOdds');
      totalOddsElem.innerText = `Total Odds: ${total.toFixed(1)}%`;
      totalOddsElem.style.color = Math.abs(total - 100) < 0.1 ? 'green' : 'red';
    }

    function toggleMusic() {
      const music = document.getElementById("backgroundMusic");
      if (music.paused) music.play();
      else music.pause();
    }

    function startNextRace() {
      const count = parseInt(document.getElementById('playerCount').value);
      players = [];
      for (let i = 0; i < count; i++) {
        const name = document.getElementById(`name${i}`).value;
        const odds = parseFloat(document.getElementById(`odds${i}`).value);
        players.push({ name, odds });
      }
      const winner = weightedDraw(players);
      finalOrder.push(winner.name);
      updateResultTable();
      document.getElementById("whistle").play();
    }

    function weightedDraw(players) {
      const total = players.reduce((sum, p) => sum + p.odds, 0);
      const rand = Math.random() * total;
      let cumulative = 0;
      for (let p of players) {
        cumulative += p.odds;
        if (rand < cumulative) return p;
      }
      return players[players.length - 1];
    }

    function updateResultTable() {
      const table = document.getElementById('resultTable');
      table.innerHTML = '';
      finalOrder.forEach((name, i) => {
        const row = document.createElement('tr');
        row.innerHTML = `<td>${i+1}</td><td>${name}</td>`;
        table.appendChild(row);
      });
      document.getElementById("cheer").play();
    }

    document.querySelectorAll(".collapsible").forEach(btn => {
      btn.addEventListener("click", function() {
        this.classList.toggle("active");
        const content = this.nextElementSibling;
        content.style.display = content.style.display === "block" ? "none" : "block";
      });
    });

    window.onload = generatePlayerInputs;
  </script>
</body>
</html>
